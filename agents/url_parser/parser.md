Окончательный итог требований к скрипту парсера URL:

## Основные характеристики

1. Парсинг одного URL с настраиваемой глубиной обхода.
2. Извлечение текста и ссылок со страницы (с возможностью расширения функционала).
3. Сохранение данных в формате JSON.
4. Обработка ошибок и логирование.
5. Структурированное сохранение данных в папках и файлах.

## Ключевые функции

1. Настройка глубины парсинга.
2. Механизм очереди для обработки ссылок в рамках одного исходного URL.
3. Аргументы командной строки для указания параметров.
4. Обход ограничений сайта (задержки между запросами).
5. Многопоточность для обработки очереди ссылок.
6. Модульная структура кода с разделением на отдельные файлы:
   - Папка `parser` для основного кода парсера
   - Папка `modules` для вспомогательных модулей
   - Папка `logs` для хранения логов
   - Папка `data` для хранения спарсенных данных (каждая сессия в отдельной подпапке)
7. Конфигурация через файл настроек.
8. Подготовка для будущей интеграции с Tor (без реализации на данном этапе).

## Структура проекта

```
url_parser/
├── parser/
│   └── main.py
├── modules/
│   ├── __init__.py
│   ├── config.py
│   ├── logger.py
│   └── utils.py
├── logs/
├── data/
└── config.yaml
```

## Дополнительные требования

1. Скрипт должен работать автономно, получая все необходимые параметры на входе.
2. Интерактивное меню для отладки и тестирования (не используется при автоматическом запуске).
3. Возможность легкого расширения функционала в будущем.
4. Интеграция с существующей системой логирования основного проекта.
5. Поддержка параллельного запуска нескольких экземпляров скрипта.

## Ожидаемое поведение

1. Скрипт принимает параметры через командную строку или конфигурационный файл.
2. Выполняет парсинг указанного URL с заданной глубиной.
3. Обрабатывает очередь ссылок, найденных на странице, используя многопоточность.
4. Сохраняет извлеченные данные в структурированном виде.
5. Логирует процесс выполнения и ошибки.
6. Предоставляет возможность настройки через конфигурационный файл.
7. Имеет подготовленное место для будущей интеграции с Tor.

## Формат JSON для сохранения данных. 

Учитывая цели парсинга и возможность дальнейшей обработки данных, подойдет следующую структура JSON для сохранения результатов:

```json
{
  "metadata": {
    "url": "https://example.com",
    "timestamp": "2023-05-15T14:30:00Z",
    "depth": 2,
    "session_id": "1684158600"
  },
  "pages": [
    {
      "url": "https://example.com",
      "title": "Example Domain",
      "content": {
        "text": "This domain is for use in illustrative examples in documents...",
        "html": "<html><body>...</body></html>"
      },
      "links": [
        {
          "url": "https://www.iana.org/domains/example",
          "text": "More information...",
          "is_internal": false
        }
      ],
      "metadata": {
        "status_code": 200,
        "content_type": "text/html",
        "encoding": "utf-8",
        "last_modified": "2023-05-10T12:00:00Z"
      }
    },
    {
      "url": "https://www.iana.org/domains/example",
      "title": "IANA — Example domains",
      "content": {
        "text": "As described in RFC 6761, we maintain a number of domains...",
        "html": "<html><body>...</body></html>"
      },
      "links": [
        {
          "url": "https://www.iana.org/",
          "text": "Internet Assigned Numbers Authority",
          "is_internal": true
        }
      ],
      "metadata": {
        "status_code": 200,
        "content_type": "text/html",
        "encoding": "utf-8",
        "last_modified": "2023-05-12T10:30:00Z"
      }
    }
  ]
}
```

Эта структура имеет следующие преимущества:

1. **Метаданные сессии**: Содержит информацию о всем процессе парсинга, включая исходный URL, время начала, глубину и уникальный идентификатор сессии.

2. **Массив страниц**: Каждая спарсенная страница представлена отдельным объектом в массиве, что позволяет легко обрабатывать данные по отдельности или в совокупности.

3. **Детальная информация о странице**: Для каждой страницы сохраняется URL, заголовок, текстовое содержимое и HTML-код, что дает гибкость при дальнейшей обработке.

4. **Структурированные ссылки**: Ссылки сохраняются с дополнительной информацией (текст ссылки, признак внутренней/внешней ссылки), что может быть полезно при анализе.

5. **Метаданные страницы**: Включают статус-код ответа, тип контента, кодировку и время последнего изменения, что может быть важно для анализа и отладки.

6. **Расширяемость**: Структура позволяет легко добавлять новые поля или секции без нарушения совместимости с существующим кодом обработки.

Эта структура JSON обеспечивает баланс между детальностью информации и удобством обработки. Она подходит для различных сценариев использования, от простого анализа текста до более сложного анализа структуры сайта и связей между страницами.
